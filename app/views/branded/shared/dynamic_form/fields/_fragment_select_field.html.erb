<%# locals: { dmp_id, field_values, parent_id, schema, field_name, template_locale, ttip } %>
<% query_id = Digest::MD5.hexdigest("#{parent_id}-#{property_name}") %>
<% unless field_label.nil?%>
  <div class="col-md-12">
    <%= f.label field_id, field_label, class: 'control-label' %>
  </div>
<% end %>
<div class="col-md-12 dynamic-field select-field linked-fragments-select <%= schema.classname %>-select select-<%= query_id %>">
  <% selected_value_id = selected_value.present? ? selected_value.id : nil %>    
  <%= select_tag field_name,
    render(partial: 'shared/dynamic_form/linked_fragment/select_options', locals: {
          select_values: [selected_value],
          selected_value: selected_value_id
        }
    ),
    data: {
      "ajax--url" => load_fragments_madmp_fragments_path(dmp_id: dmp_id, schema_id: schema.id),
      "ajax--cache" => true,
      "ajax--delay" => 250
    },
    disabled: readonly,
    include_blank: false,
    "data-toggle": "tooltip",
    title: ttip,
    id: field_id,
    class: "form-control" %>

  <% unless parent_id.nil? || readonly %>
    <span data-toggle="modal" data-target="#modal-window">
      <%= link_to new_edit_linked_madmp_fragments_url(
              nil, 
              :parent_id => parent_id, 
              :schema_id => schema.id, 
              :template_locale => template_locale,
              :source => "select-modal",
              :property_name => property_name,
              :query_id => query_id
        ),  {
          :remote => true, 
          :target => "_self",
          :class  => "add-fragment",
          'data-toggle' =>  "tooltip",
          'data-original-title' => d_("dmpopidor", "Click here to add a new item")
      } do %>
        <i class="fa fa-plus-square"></i>
      <% end %>
    </span>
  <% end %>
</div>

<div class="col-md-12 selected-value">
  <% unless selected_value.nil?%>
    <strong><%= d_('dmpopidor', 'Selected value:') %></strong> <span><%= selected_value.to_s %></span>
    (<%= link_to new_edit_linked_madmp_fragments_url(
        :fragment_id => selected_value.id,
        :parent_id => parent_id, 
        :schema_id => selected_value.madmp_schema_id,
        :source => "select-modal",
        :template_locale => template_locale,
        :query_id => query_id
      ), {
        :remote => true, 
        :target => "_self",
        'data-toggle' => 'modal', 
        'data-target' => '#modal-window'
      } do %>
        <%= _('Edit') %>
      <% end %>)
  <% end %>
</div>