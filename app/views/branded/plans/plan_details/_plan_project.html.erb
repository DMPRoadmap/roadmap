<%# locals: { persons } %>
<% project_abstract_tooltip = _("Briefly summarise your research project to help others understand the purposes for which the data are being collected or created.") %>

<% project = @plan.json_fragment().project.data %>
<% fundings = @plan.json_fragment().project.fundings %>
<% partners = @plan.json_fragment().project.partners %>
<% principalInvestigator = @plan.json_fragment().project.principalInvestigator %>

<div class="form-group"><!-- project_title -->
  <%= create_text_field(
        f, 
        project["title"], 
        "project_title", 
        _('Project title')
      ) 
  %>
</div>
<div class="form-group"><!-- project_acronym -->
  <%= create_text_field(
        f, 
        project["acronym"], 
        "project_acronym", 
        _('Acronym')
      ) 
  %>
</div>
<div class="form-group"><!-- project_id -->
  <%= create_text_field(
        f, 
        project["projectId"], 
        "project_id", 
        _('Project ID')
      ) 
  %>
</div>
<div class="form-group"><!-- project_description -->
  <div class="col-md-12">
    <%= f.label "plan[project_description]", _('Project abstract'), class: 'control-label' %>
  </div>
  <div class="col-md-10" data-toggle="tooltip" title="<%= project_abstract_tooltip %>">
    <em class="sr-only"><%= project_abstract_tooltip %></em>
    <%= text_area_tag "plan[project_description]", project["description"],
                        { rows: 6, class: "form-control tinymce", "aria-required": true,
                        'data-toggle': 'tooltip', spellcheck: true } %>
  </div>
</div>

<fieldset class="project-details funding-list">
  <%= render(partial: 'plans/plan_details/linked_fragment_list', locals: {
    plan: @plan,
    parent_id: @plan.json_fragment().project.id,
    obj_list: fundings,
    type: "funding"
  }) %>
</fieldset>

<div class="form-group"><!-- project_start_date -->
  <%= create_date_field(
        f, 
        project["startDate"], 
        "project_start_date", 
        _('Start Date')
      ) 
  %>
</div>
<div class="form-group"><!-- project_end_date -->
  <%= create_date_field(
        f, 
        project["endDate"], 
        "project_end_date", 
        _('End Date')
      ) 
  %>
</div>

<fieldset class="project-details partner-list">
  <%= render(partial: 'plans/plan_details/linked_fragment_list', locals: {
    plan: @plan,
    parent_id: @plan.json_fragment().project.id,
    obj_list: partners,
    type: "partner"
  }) %>
</fieldset>

<div class="form-group"><!-- experimental_plan_url -->
  <%= create_url_field(
        f, 
        project["experimentalPlanUrl"], 
        "experimental_plan_url", 
        _('Experimental Plan URL')
      ) 
  %>
</div>


<%= render(partial: 'shared/fragments/person_fragment_form', locals: {
            f: f,
            legend: _("Principal Investigator"),
            person: principalInvestigator ? principalInvestigator.data : nil,
            person_id: principalInvestigator ? principalInvestigator.id : nil,
            person_list: persons,
            plan: @plan,
            fragment_name: "principalInvestigator"
      }) %>

<%= f.button(_('Save'), class: "btn btn-default", type: "submit") %>