<%# locals: { persons } %>
<% meta = meta_fragment.data %>
<% contact = meta_fragment.contact %>
<% dmpID = meta["dmpID"] %>
<% licence = meta["licence"] %>

<div class="form-group"><!-- title -->
  <div class="col-md-12">
    <%= f.label(:title, 'Plan title', class: 'control-label') %>
  </div>
  <div class="col-md-10">
    <%= f.text_field(:title, class: "form-control", "aria-required": true, title: "Data management plan deliverable 1.4 ou D6.6",
         'data-toggle': 'tooltip', spellcheck: true) %>
    <div class="checkbox">
      <%= f.hidden_field :visibility %>
      <%= f.label(:is_test, class: 'control-label') do %>
        <%= check_box_tag(:is_test, 1, @plan.is_test?, "aria-label": "is_test") %>
        <%= _('mock plan for testing, practice, or educational purposes') %>
      <% end %>
    </div>
  </div>
</div>
<div class="form-group"><!-- plan description -->
  <div class="col-md-12">
    <%= f.label(:description, 'Description', class: 'control-label') %>
  </div>
  <div class="col-md-10" data-toggle="tooltip" title="Define the purpose and scope of the DMP as well as its relation to other deliverables and briefly explains the structure of the document">
    <%= f.text_area(
          :description, rows: 6,
          class: 'form-control tinymce',
          "aria-required": false) %>
  </div>
</div>
<div class="form-group"><!-- dmpLanguage -->
    <%= create_text_field(
          f, 
          @plan.template.locale, 
          "dmpLanguage", 
          'DMP language code',
          "dmp_language",
          readonly: true
        ) 
    %>
</div>

<%= render(partial: 'shared/fragments/person_fragment_form', locals: {
            f: f,
            legend: 'DMP coordinator',
            person: contact ? contact.data : nil,
            person_id: contact ? contact.id : nil,
            person_list: persons,
            plan: @plan,
            fragment_name: "contact", 
            tooltip: "Person who coordinates data management planning, also called DMP author or manager. By default, the person who creates the DMP with DMP OPIDoR"
      }) %>

<div class="form-group"><!-- creationDate -->
    <%= create_text_field(
          f, 
          meta["creationDate"], 
          "creationDate", 
          'Creation date',
          "creation_date",
          readonly: true
        ) 
    %>
</div>

<div class="form-group"><!-- lastModifiedDate -->
    <%= create_text_field(
          f, 
          meta["lastModifiedDate"], 
          "lastModifiedDate", 
          'Last modification date',
          "last_modified_date",
          readonly: true
        ) 
    %>
</div>

<div class="form-group"><!-- Identifier Type -->
  <%= create_select_field(
        f, 
        dmpID ? dmpID["idType"] : "DOI",
        "plan[dmpID[idType]]", 
        'Identifier Type',
        "dmp_id_type",
        ["DOI", "HANDLE", "ARK", "URL"]
      ) 
  %>
</div>
<div class="form-group"><!-- identifier -->
  <%= create_text_field(
        f, 
        dmpID ? dmpID["value"] : nil,  
        "dmpID[value]",
        'DMP persistent identifier', 
        "dmp_id_value",
        ttip: "Provide the plan ID after possible publishing or deposit in an archive"
      ) 
  %>
</div>


<fieldset class="project-details">
  <legend class="project-details"><%= 'DMP Licence' %></legend>
  <div class="form-group"><!-- licenseName -->
    <%= create_text_field(
          f, 
          licence ? licence["licenseName"] : nil,
          "licence[licenseName]",
          'Licence name', 
          "licence_name"
        ) 
    %>
  </div>
  <div class="form-group"><!-- licenseUrl -->
    <%= create_url_field(
          f, 
          licence ? licence["licenseUrl"] : nil,
          "licence[licenseUrl]",
          'Licence URL', 
          "licence_url"
        ) 
    %>
  </div>
  <div class="form-group"><!-- licenceStartDate -->
    <%= create_date_field(
          f, 
          licence ? licence["licenceStartDate"] : nil,
          "licence[licenceStartDate]",
          'License start date', 
          "licence_start_date",
          ttip: "Date from which the DMP is shared publicly and can be reused"
        ) 
    %>
  </div>
</fieldset>

<div class="form-group"><!-- relatedDocUrl -->
    <%= render(partial: 'shared/dynamic_form/fields/simple_multiple_field', locals: { 
      f: f, 
      field_values: meta["relatedDoc"],
      readonly: false,
      field_label: 'Related Documentation',
      field_properties: {
        "type" => "string",
        "format" => "uri"
      },
      field_name: "relatedDoc", ttip: "Provide the documents associated with the DMP", answer_id: nil 
      })
    %>
</div>
<div class="form-group"><!-- associatedDMP -->
    <%= render(partial: 'shared/dynamic_form/fields/simple_multiple_field', locals: { 
      f: f, 
      field_values: meta["associatedDmp"],
      readonly: false,
      field_label: 'Associated DMPs reference',
      field_properties: {
        "type" => "string"
      },
      field_name: "associatedDmp", ttip: "Provide the other DMPs associated with the project", answer_id: nil 
      })
    %>
</div>

<%= f.button(_('Save'), class: "btn btn-default", type: "submit") %>