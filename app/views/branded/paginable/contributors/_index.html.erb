<%# locals: @plan, scope %>
<% template_locale = LocaleService.to_gettext(locale: @plan.template.locale) %>
<table class="table table-hover list-contributor linked-fragments-list">
  <thead>
    <tr>
      <th scope="col"><%= _("Name") %></th>
      <th scope="col" class="sorter-false"><%= _("Affiliation") %></th>
      <th scope="col" class="sorter-false"><%= _("Attributed roles (Associated research outputs)") %></th>
      <th scope="col" class="sorter-false">
        <span aria-hidden="false" class="sr-only"><%= _("Actions") %></span>
      </th>
    </tr>
  </thead>
  <tbody>
    <% scope.each do |contributor| %>
      <% person_id = contributor.data["personId"]%>
      <tr>
        <td>
          <%= contributor.to_s %>
          <% if person_id.present? %>
            - <%= uri?(person_id) ? link_to(person_id, person_id, target: "_blank") : person_id %>
          <% end %>
        </td>
        <td><%= contributor.data["affiliationName"] %></td>
        <td class="roles">
          <ul>
            <% contributor.roles.each do |role| %>
              <li><%= role %></li>
            <% end %>
          </ul>  
        </td>
        <td class="actions contributors">
          <% if @plan.editable_by?(current_user.id) %>
            <%= link_to new_edit_linked_madmp_fragments_url(
                  :fragment_id => contributor.id, 
                  :parent_id => contributor.dmp_id, 
                  :schema_id => contributor.madmp_schema_id,
                  :template_locale => template_locale,
                  :source => "list-modal",
                  :query_id => "contributor"
              ), {
                  :remote => true, 
                  :target => "_self",
                  'data-toggle' => 'modal', 
                  'data-target' => '#modal-window'
              } do %>
              <span data-toggle="tooltip" 
                    data-original-title="<%= _('Edit') %>" 
                    class="fas fa-pen-to-square"></span>
            <% end %>
            <% if scope.length > 1 %>
              <span class="delete fas fa-xmark" 
                aria-hidden="true"
                data-toggle="tooltip" 
                data-original-title="<%= _('Delete') %>"
                data-confirm-message="<%= _('Do you want to delete this element?') %>"
                data-url="<%= destroy_contributor_madmp_fragments_path(
                  contributor_id: contributor.id,
                  query_id: "contributor",
                  readonly: false,
                  template_locale: template_locale) 
                %>"></span>
            <% end %>
          <% else %>
            <%= link_to show_linked_madmp_fragments_url(
                  :fragment_id => contributor.id,
                  :template_locale => template_locale,
              ), {
                  :remote => true, 
                  'data-toggle' => 'modal', 
                  'data-target' => '#modal-window'
              } do %>
              <span data-toggle="tooltip" 
                    data-original-title="<%= _('View') %>" 
                    class="fas fa-eye"></span>
            <% end %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
